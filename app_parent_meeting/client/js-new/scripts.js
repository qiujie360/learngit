"use strict";var wxQj={share:function(e){wx.config(wxConfig),wx.ready(function(){var t=angular.extend({},e);if(t.link="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxa7aaaa4241ca554e&redirect_uri=http%3A%2F%2Fwww.8dsun.com%2Fo.php%3Fcid%3D8aadb31e54f133b60154f1393a050023%26jump%3D0",t.params)for(var r in t.params)t.link+="%26"+r+"%3d"+t.params[r];t.link+="&response_type=code&scope=snsapi_base&state=123",t.imgUrl||(t.imgUrl=angular.isObject(document.images)&&angular.isObject(document.images[0])&&document.images[0].src);var n=t;wx.onMenuShareAppMessage(n),wx.onMenuShareTimeline(n)})}};angular.module("meetApp",["ngRoute","ngMessages","ngSanitize","meetApp.controllers","meetApp.restServices","JqpApp.services"]).constant("rcontextPath",angular.rcontextPath).factory("authInterceptor",["$rootScope","$q",function(e,t){return{request:function(t){return t.headers=t.headers||{},t.headers.Authorization=e.userId,t},response:function(e){return 401===e.status,e||t.when(e)}}}]).run(["$rootScope","$location","$routeParams","Jqcommon","Meet",function(e,t,r,n,a){var o=t.search();o.uid&&(sessionStorage.uid=o.uid),e.uid=sessionStorage.uid,e.rcontextPath=angular.rcontextPath,e.contextPath=angular.contextPath,e.jqmode=o.jqmode,n.getUserData(sessionStorage.uid,function(t){1===t.status&&(e.userId=t.userId)}),e.$on("$routeChangeSuccess",function(t,n,o){e.fid||(r.fid&&(sessionStorage.fid=r.fid),e.fid=sessionStorage.fid),void 0==e.schoolName&&(e.schoolName="",a.getSchollName({fid:e.fid},function(t){e.schoolName=t})),wx.ready(function(){wx.hideMenuItems({menuList:["menuItem:copyUrl","menuItem:share:qq","menuItem:share:weiboApp","menuItem:share:QZone","menuItem:openWithQQBrowser","menuItem:openWithSafari","menuItem:favorite","menuItem:share:email"]})})}),o.path&&t.path(o.path)}]).config(["$routeProvider","$locationProvider","$httpProvider","$sceDelegateProvider",function(e,t,r,n){var a=angular.contextPathDir+"client/";e.when("/",{templateUrl:a+"template/index.html?v="+angular.v,controller:"IndexController"}).when("/bindErr",{templateUrl:a+"template/bind-err.html?v="+angular.v,controller:"BindErrController"}).when("/video/:meetingId",{templateUrl:a+"template/video.html?v="+angular.v,controller:"VideoController"}).otherwise({redirectTo:"/"}),r.interceptors.push("authInterceptor"),n.resourceUrlWhitelist(["self","**"]),r.defaults.useXDomain=!0,delete r.defaults.headers.common["X-Requested-With"],t.html5Mode(!1),r.defaults.transformRequest=function(e){return void 0===e?e:$.param(e)},r.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"}]),angular.module("meetApp.controllers",[]).filter("timeToNow",[function(){function e(e){for(var t=e.toString().length;t<2;t++)e="0"+e;return e}return function(t){var r=(new Date).getTime(),n=parseInt((parseInt(t)-r)/1e3);if(n<=0)return"00:00:00";var a=parseInt(n/3600),o=parseInt(n%3600/60),i=parseInt(n%60);return e(a)+":"+e(o)+":"+e(i)}}]).filter("shortNum",[function(){return function(e){return e?(e=parseInt(e),e>=1e4?(e/1e4).toFixed(1)+"w":e>=1e3?(e/1e3).toFixed(1)+"k":e):0}}]).controller("IndexController",["$rootScope","$scope","$location","$window","Meet",function(e,t,r,n,a){var o=e.view={};o.show=!1;var i=e.Global;angular.isObject(i)||(i=e.Global={}),i.bg02=!1,i.search={};var s=r.search();for(var d in s)angular.isArray(s[d])?i.search[d]=s[d][0]:i.search[d]=s[d];e.headTitle="家长会",t.navSelect=function(e){t.currentIndex=e};var c,l;a.getMlist({fid:i.search.fid,uid:i.search.uid},function(r){var n,a=0;c=r.items,a=r.currentNum,l=r.extendData.displayName,n=r.extendData.serverTime;var s={params:{fid:i.search.fid},title:e.schoolName+"家长会",desc:e.schoolName+"掌上家长会"};a&&(s.imgUrl=c[0].poster),wxQj.share(s),t.meetingList=c,t.ctime=n,t.meetingNum=a,o.show=!0}),t.attOrCheck=function(t){e.meeting=t,e.meeting.nickname=l,r.path("/video/"+t.meetingId)}}]).controller("VideoController",["$rootScope","$scope","$location","$window","$timeout","Meet","$routeParams",function(e,t,r,n,a,o,i){function s(e){var t=e.nickname;t=t?encodeURIComponent(t):encodeURIComponent("游客"+Math.ceil(1e6*Math.random()));var r=[],n=1;return"2"!=e.state?r.push({url:e.attendeeJoinUrl}):(e.recordList&&(e.recordList=JSON.parse(e.recordList)),angular.isArray(e.recordList)&&e.recordList.length>0&&(r=e.recordList,n=e.recordList.length)),{token:e.attendeeToken,nickname:t,urlList:r,state:e.state,num:n,webcastId:e.webcastId}}function d(){var a,i,s=r.search(),d="uid="+s.uid+"&fid="+s.fid,l=angular.hostname+"/WebApp/app_parent_meeting/client/";d+="&backPath="+l,o.enterMeet({fid:s.fid,meetingId:p.meetingId},function(r){if(t.clicked=!1,1==r.status)c();else{var o=r.data;i=angular.isArray(o)&&1==o.length?"/selectIdentity/"+s.fid+"/"+o[0].gradeId+"/"+o[0].groupId:"/selectClass/"+s.fid,e.userId?a=angular.hostname+"/WebApp/appPersonCenter/#"+i:(d+="&nextPath="+i,a=angular.hostname+"/WebApp/appPersonCenter/#/bindMobile/0"),n.location.replace(a+"?"+d)}})}function c(){function e(e,t,r){if(e.indexOf(t)===-1)return e.indexOf("?")===-1&&(e+="?"),e.indexOf("=")!==-1&&(e+="&"),e+=t+"="+r}var i={params:{fid:r.search().fid,path:r.path()},title:p.meetingName,desc:p.meetingName};i.imgUrl=p.poster,wxQj.share(i),t.video=m,t.selVideo=function(n,a){t.cIndex=a,n.url||(u.bindErr=3,r.path("/bindErr").replace());var o=e(n.url,"token",m.token);o=e(o,"nickName",m.nickname),t.meetingUrl=o},m.urlList.length?(l.show=!0,t.selVideo(m.urlList[0],0),a(function(){$("#videoIframe").height($(n).height()-$("#videoXj").height())},1e3),$("#videoIframe").height($(n).height()-$("#videoXj").height()),$("#videoLoading").height($(n).height())):(u.bindErr=3,r.path("/bindErr").replace()),o.addJoinLog(m.webcastId),o.addHitNum(m.webcastId)}var l=e.view={},u=e.Global;u?u.bg02=!1:u=e.Global={};var m,h=i.meetingId,p=e.meeting;p?(e.headTitle=p.meetingName,m=s(p),0!=p.meetingType?c():d()):o.getVideoDetail({meetingId:h},function(t){1===t.status?(p=t.data.info,p.nickname=t.data.displayName,e.headTitle=p.meetingName):p={},m=s(p),0!=p.meetingType?c():d()})}]).controller("BindErrController",["$rootScope","$scope","$location","Meet",function(e,t,r,n){var a=e.view={};a.show=!1;var o=e.Global;t.bindErr=o.bindErr,delete o.bindErr,o.bg02=!1,a.show=!0}]);